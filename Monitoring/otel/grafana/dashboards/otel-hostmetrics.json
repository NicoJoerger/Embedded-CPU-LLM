{
  "uid": "otel-hostmetrics",
  "title": "OTel Hostmetrics",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 3,
  "refresh": "10s",
  "panels": [
    {
      "type": "timeseries",
      "title": "CPU Utilization (%)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.time\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: r._value * 100.0 }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group(columns: [\"state\"], mode: \"by\")",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Memory Utilization (%)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.memory.usage\")\n  |> filter(fn: (r) => r.state == \"used\" or r.state == \"free\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> pivot(rowKey: [\"_time\", \"host.name\"], columnKey: [\"state\"], valueColumn: \"_value\")\n  |> map(fn: (r) => ({ r with _value: r.used / (r.used + r.free) * 100.0 }))\n  |> keep(columns: [\"_time\", \"_value\", \"host.name\"])",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        }
      }
    },
    {
      "type": "timeseries",
      "title": "System Load Average",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.load_average.1m\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "A"
        },
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.load_average.5m\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "B"
        },
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.load_average.15m\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "C"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Memory Usage (Bytes)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.memory.usage\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Disk I/O Operations",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.disk.operations\")\n  |> filter(fn: (r) => r.device !~ /^loop/ and r.device !~ /^ram/ and r.device !~ /^dm-/)\n  |> derivative(unit: 1s, nonNegative: true)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group(columns: [\"direction\", \"device\"], mode: \"by\")",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 16 },
      "fieldConfig": {
        "defaults": {
          "unit": "iops"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Disk I/O Throughput",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.disk.io\")\n  |> filter(fn: (r) => r.device !~ /^loop/ and r.device !~ /^ram/ and r.device !~ /^dm-/)\n  |> derivative(unit: 1s, nonNegative: true)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group(columns: [\"direction\", \"device\"], mode: \"by\")",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 16 },
      "fieldConfig": {
        "defaults": {
          "unit": "Bps"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Network I/O Throughput",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.network.io\")\n  |> filter(fn: (r) => r.device != \"lo\" and r.device !~ /^docker/ and r.device !~ /^veth/ and r.device !~ /^br-/)\n  |> derivative(unit: 1s, nonNegative: true)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group(columns: [\"direction\", \"device\"], mode: \"by\")",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 24 },
      "fieldConfig": {
        "defaults": {
          "unit": "Bps"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Network Packets",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.network.packets\")\n  |> filter(fn: (r) => r.device != \"lo\" and r.device !~ /^docker/ and r.device !~ /^veth/ and r.device !~ /^br-/)\n  |> derivative(unit: 1s, nonNegative: true)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group(columns: [\"direction\", \"device\"], mode: \"by\")",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 24 },
      "fieldConfig": {
        "defaults": {
          "unit": "pps"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Filesystem Utilization (%)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.filesystem.usage\")\n  |> filter(fn: (r) => r.type != \"tmpfs\" and r.type != \"devtmpfs\" and r.type != \"overlay\" and r.mountpoint != \"/dev\" and r.mountpoint != \"/dev/shm\")\n  |> filter(fn: (r) => r.state == \"used\" or r.state == \"free\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> pivot(rowKey: [\"_time\", \"mountpoint\"], columnKey: [\"state\"], valueColumn: \"_value\")\n  |> map(fn: (r) => ({ r with _value: r.used / (r.used + r.free) * 100.0 }))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Filesystem Usage (Bytes)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.filesystem.usage\")\n  |> filter(fn: (r) => r.type != \"tmpfs\" and r.type != \"devtmpfs\" and r.type != \"overlay\" and r.mountpoint != \"/dev\" and r.mountpoint != \"/dev/shm\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "CPU Utilization (from Idle) (%)",
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.time\")\n  |> filter(fn: (r) => r.state == \"idle\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: 100.0 - (r._value * 100.0) }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)",
          "refId": "A"
        },
        {
          "query": "from(bucket: \"llm\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"prometheus\" and r._field == \"system.cpu.time\")\n  |> filter(fn: (r) => r.state == \"idle\")\n  |> derivative(unit: 1s, nonNegative: true)\n  |> map(fn: (r) => ({ r with _value: 100.0 - (r._value * 100.0) }))\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> group()\n  |> mean()\n  |> map(fn: (r) => ({ r with cpu: \"total\" }))",
          "refId": "B"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      }
    }
  ]
}
